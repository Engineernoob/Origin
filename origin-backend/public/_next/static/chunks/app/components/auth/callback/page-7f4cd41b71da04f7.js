(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[372],{1081:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,O:()=>c});var a,s=r(5155),n=r(2115),l=r(9509);let u=(0,n.createContext)(void 0),o="https://origin-backend-misty-shape-4040.fly.dev".replace(/\/$/,"")||(null==(a=l.env.NEXT_PUBLIC_BACKEND_URL)?void 0:a.replace(/\/$/,""))||"http://localhost:8080";function c(e){let{children:t}=e,[r,a]=(0,n.useState)(null),[l,c]=(0,n.useState)(null),[i,d]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("auth_token");e?(c(e),h(e)):d(!1)},[]);let h=async e=>{try{let t=await fetch("".concat(o,"/auth/me"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(t.ok){let e=await t.json();if(e.error)throw Error(e.error);a(e)}else m()}catch(e){console.error("Failed to fetch current user:",e),m()}finally{d(!1)}},m=()=>{localStorage.removeItem("auth_token"),c(null),a(null),d(!1)},f=async()=>{l&&await h(l)};return(0,s.jsx)(u.Provider,{value:{user:r,token:l,isLoading:i,login:e=>{localStorage.setItem("auth_token",e),c(e),d(!0),h(e)},logout:m,refreshUser:f},children:t})}function i(){let e=(0,n.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1254:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var a=r(5155),s=r(2115),n=r(5695),l=r(1081);function u(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)().get("token"),{login:r}=(0,l.A)();return(0,s.useEffect)(()=>{if(!t)return void e.replace("/?auth=failed");r(t),e.replace("/")},[t,e,r]),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-lg",children:"Signing you in…"})]})})}function o(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-lg",children:"Loading…"})]})}),children:(0,a.jsx)(u,{})})}},2647:(e,t,r)=>{Promise.resolve().then(r.bind(r,1254))},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})}},e=>{e.O(0,[441,964,358],()=>e(e.s=2647)),_N_E=e.O()}]);